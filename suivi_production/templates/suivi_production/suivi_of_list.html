{% extends "suivi_production/base.html" %}
{% load i18n l10n %}

{% block title %}{% translate "Suivi de l'Atelier" %}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>{% translate "Suivi de l'Atelier" %} - {% translate "Vue d'Ensemble" %}</h1>
    <form method="get" class="d-flex gap-2">
        <input type="text" name="numero" value="{{ filtre_numero }}" class="form-control" placeholder="{% translate 'Numéro OF' %}">
        <button class="btn btn-primary" type="submit">{% translate 'Filtrer' %}</button>
        <a class="btn btn-outline-secondary" href="{% url 'suivi_atelier' %}">{% translate 'Réinitialiser' %}</a>
    </form>
</div>

<div class="row">
    {% for of in ofs %}
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card h-100 shadow-sm card-of-link">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h5 class="card-title mb-1">{{ of.numero_of }}</h5>
                        <h6 class="card-subtitle text-muted">{{ of.titre }}</h6>
                    </div>
                    {% if of.statut == 'PLANIFIE' %}
                        <span class="badge bg-secondary">{% translate "Planifié" %}</span>
                    {% elif of.statut == 'PRODUCTION' %}
                        <span class="badge bg-primary">{% translate "En Production" %}</span>
                    {% elif of.statut == 'TERMINE' %}
                        <span class="badge bg-success">{% translate "Terminé" %}</span>
                    {% endif %}
                </div>

                <hr>
                
                <div class="mt-3">
                    <div class="d-flex justify-content-between">
                        <span class="small">{% translate "Progression" %}</span>
                        <!-- Le pourcentage n'est plus affiché ici, mais dans la barre -->
                    </div>

                    <!-- ==================== DÉBUT DE LA SECTION CORRIGÉE ==================== -->
                    <div class="progress mt-1" style="height: 20px;">
                        <!-- Barre bleue avec le pourcentage à l'intérieur -->
                    <div class="progress-bar bg-primary fw-bold" 
                            role="progressbar" 
                        style="width: {{ of.progression_production|unlocalize }}%;" 
                        aria-valuenow="{{ of.progression_production|floatformat:0|unlocalize }}" 
                            aria-valuemin="0" 
                            aria-valuemax="100">
                            {% if of.progression_production > 0 %}{{ of.progression_production|floatformat:0 }}%{% endif %}
                        </div>
                    </div>
                    <!-- ===================== FIN DE LA SECTION CORRIGÉE ===================== -->

                    <div class="d-flex justify-content-between mt-2">
                        <span class="small text-muted">{{ of.quantite_produite_actuelle }} / {{ of.quantite_a_produire }} {% translate "bonnes" %}</span>
                        {% if of.quantite_rebut_totale > 0 %}
                            <span class="small text-danger">{{ of.quantite_rebut_totale }} {% translate "rebuts" %}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            <a href="{% url 'suivi_detail_of' of.pk %}" class="stretched-link"></a>
        </div>
    </div>
    {% empty %}
    <div class="col">
        <div class="card card-body text-center">
            <p class="mb-2">{% translate "Aucun Ordre de Fabrication à suivre pour le moment." %}</p>
            <p><a href="{% url 'of_list' %}" class="btn btn-sm btn-primary">{% translate "Gérer les OFs" %}</a></p>
        </div>
    </div>
    {% endfor %}
</div>

<style>
    .card-of-link {
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    .card-of-link:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.1) !important;
    }
</style>
{% endblock %}